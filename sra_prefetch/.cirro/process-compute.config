/*
 * Cirro compute configuration overrides
 * 
 * This file is merged with the pipeline's nextflow.config
 * and can override settings for the Cirro/AWS environment.
 */

// Process-specific settings
process {
    // Default container for all processes
    container = "quay.io/biocontainers/sra-tools:3.0.3--h87f3376_0"
    
    // Retry failed jobs with more memory/disk (useful for variable SRA file sizes)
    errorStrategy = 'retry'
    maxRetries = 2
    
    // Memory scaling on retry
    memory = { 8.GB * task.attempt }
    
    // Process-specific overrides
    withName: 'PREFETCH_SRA' {
        // Disk scaling on retry (if file is larger than expected)
        // Uses the max_file_size parameter, doubling on each retry
        disk = { 
            def baseSize = params.max_file_size ?: 500
            "${baseSize * task.attempt} GB"
        }
    }
}

// AWS Batch settings (Cirro runs on AWS)
aws {
    batch {
        // Use spot instances for cost savings
        jobRole = null  // Cirro manages this
    }
}

